/* 
 * leaflet.activelayer v0.0.1 | License: MIT 
 */
!function(a,b){"object"==typeof exports&&"object"==typeof module?module.exports=b(require("leaflet")):"function"==typeof define&&define.amd?define(["leaflet"],b):"object"==typeof exports?exports["leaflet.activelayer"]=b(require("leaflet")):a["leaflet.activelayer"]=b(a.leaflet)}(this,function(a){return function(a){function b(d){if(c[d])return c[d].exports;var e=c[d]={exports:{},id:d,loaded:!1};return a[d].call(e.exports,e,e.exports,b),e.loaded=!0,e.exports}var c={};return b.m=a,b.c=c,b.p="",b(0)}([function(a,b,c){a.exports={DataActivationLayer:c(1)}},function(a,b,c){function d(a){if(!a)return null;var b=a.geometry;if(!b||!b.coordinates)return null;var c;if("Point"==b.type){var d=b.coordinates,f=e.latLng(d[1],d[0]);c=e.latLngBounds(f,f)}else{var g=e.GeoJSON.geometryToLayer(b);c=g.getBounds()}return c}var e=c(2),f=c(3),g=e.Class.extend({includes:[e.Mixin.Events],initialize:function(a){e.setOptions(this,a),this.setData(this.options.data)},onAdd:function(a){this._map=a,this._setDelegateEvents("on")},onRemove:function(a){this._setDelegateEvents("off"),this._map=a},_setDelegateEvents:function(a){var b=this._map;["mousemove","click"].forEach(function(c){var d=e.Util.limitExecByInterval(this._delegateEvents.bind(this,c),10);b[a](c,d)},this)},_delegateEvents:function(a,b){if(this.hasEventListeners(a)){var c=this._map,d=b.latlng,f=c.project(d),g=this._getRadius(),h=f.add([g,-g]),i=f.add([-g,g]),j=e.latLngBounds(c.unproject(h),c.unproject(i)),k=this.getData(j);b.data=k,b.bbox=j,b.radius=g,this.fire(a,b)}},_getRadius:function(){var a=this.options.radius||10;return"function"==typeof a&&(a=this.options.radius(this)),a},setData:function(a){this._indexData(a)},getData:function(a){return this._searchInBbox(a)},_indexData:function(a){this._rtree=f(9),a=a||[];for(var b=[],c=this,d=0;d<a.length;d++){var e=a[d],g=c._getBoundingBox(e);if(g){var h=c._toIndexKey(g);h.data=e,b.push(h)}}this._rtree.load(b)},_searchInBbox:function(a){for(var b=this._toIndexKey(a),c=this._rtree.search(b),d=[],e=0;e<c.length;e++){var f=c[e];d.push(f.data)}return d},_toIndexKey:function(a){var b=a.getSouthWest(),c=a.getNorthEast(),d=[b.lat,b.lng,c.lat,c.lng];return d},_getBoundingBox:d});a.exports=g},function(b){b.exports=a},function(a,b,c){var d;!function(){"use strict";function e(a,b){return this instanceof e?(this._maxEntries=Math.max(4,a||9),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),b&&this._initFormat(b),void this.clear()):new e(a,b)}function f(a,b){a.bbox=g(a,0,a.children.length,b)}function g(a,b,c,d){for(var e,f=h(),g=b;c>g;g++)e=a.children[g],i(f,a.leaf?d(e):e.bbox);return f}function h(){return[1/0,1/0,-1/0,-1/0]}function i(a,b){return a[0]=Math.min(a[0],b[0]),a[1]=Math.min(a[1],b[1]),a[2]=Math.max(a[2],b[2]),a[3]=Math.max(a[3],b[3]),a}function j(a,b){return a.bbox[0]-b.bbox[0]}function k(a,b){return a.bbox[1]-b.bbox[1]}function l(a){return(a[2]-a[0])*(a[3]-a[1])}function m(a){return a[2]-a[0]+(a[3]-a[1])}function n(a,b){return(Math.max(b[2],a[2])-Math.min(b[0],a[0]))*(Math.max(b[3],a[3])-Math.min(b[1],a[1]))}function o(a,b){var c=Math.max(a[0],b[0]),d=Math.max(a[1],b[1]),e=Math.min(a[2],b[2]),f=Math.min(a[3],b[3]);return Math.max(0,e-c)*Math.max(0,f-d)}function p(a,b){return a[0]<=b[0]&&a[1]<=b[1]&&b[2]<=a[2]&&b[3]<=a[3]}function q(a,b){return b[0]<=a[2]&&b[1]<=a[3]&&b[2]>=a[0]&&b[3]>=a[1]}function r(a,b,c,d,e){for(var f,g=[b,c];g.length;)c=g.pop(),b=g.pop(),d>=c-b||(f=b+Math.ceil((c-b)/d/2)*d,s(a,b,c,f,e),g.push(b,f,f,c))}function s(a,b,c,d,e){for(var f,g,h,i,j,k,l,m,n;c>b;){for(c-b>600&&(f=c-b+1,g=d-b+1,h=Math.log(f),i=.5*Math.exp(2*h/3),j=.5*Math.sqrt(h*i*(f-i)/f)*(0>g-f/2?-1:1),k=Math.max(b,Math.floor(d-g*i/f+j)),l=Math.min(c,Math.floor(d+(f-g)*i/f+j)),s(a,k,l,d,e)),m=a[d],g=b,n=c,t(a,b,d),e(a[c],m)>0&&t(a,b,c);n>g;){for(t(a,g,n),g++,n--;e(a[g],m)<0;)g++;for(;e(a[n],m)>0;)n--}0===e(a[b],m)?t(a,b,n):(n++,t(a,n,c)),d>=n&&(b=n+1),n>=d&&(c=n-1)}}function t(a,b,c){var d=a[b];a[b]=a[c],a[c]=d}e.prototype={all:function(){return this._all(this.data,[])},search:function(a){var b=this.data,c=[],d=this.toBBox;if(!q(a,b.bbox))return c;for(var e,f,g,h,i=[];b;){for(e=0,f=b.children.length;f>e;e++)g=b.children[e],h=b.leaf?d(g):g.bbox,q(a,h)&&(b.leaf?c.push(g):p(a,h)?this._all(g,c):i.push(g));b=i.pop()}return c},load:function(a){if(!a||!a.length)return this;if(a.length<this._minEntries){for(var b=0,c=a.length;c>b;b++)this.insert(a[b]);return this}var d=this._build(a.slice(),0,a.length-1,0);if(this.data.children.length)if(this.data.height===d.height)this._splitRoot(this.data,d);else{if(this.data.height<d.height){var e=this.data;this.data=d,d=e}this._insert(d,this.data.height-d.height-1,!0)}else this.data=d;return this},insert:function(a){return a&&this._insert(a,this.data.height-1),this},clear:function(){return this.data={children:[],height:1,bbox:h(),leaf:!0},this},remove:function(a){if(!a)return this;for(var b,c,d,e,f=this.data,g=this.toBBox(a),h=[],i=[];f||h.length;){if(f||(f=h.pop(),c=h[h.length-1],b=i.pop(),e=!0),f.leaf&&(d=f.children.indexOf(a),-1!==d))return f.children.splice(d,1),h.push(f),this._condense(h),this;e||f.leaf||!p(f.bbox,g)?c?(b++,f=c.children[b],e=!1):f=null:(h.push(f),i.push(b),b=0,c=f,f=f.children[0])}return this},toBBox:function(a){return a},compareMinX:function(a,b){return a[0]-b[0]},compareMinY:function(a,b){return a[1]-b[1]},toJSON:function(){return this.data},fromJSON:function(a){return this.data=a,this},_all:function(a,b){for(var c=[];a;)a.leaf?b.push.apply(b,a.children):c.push.apply(c,a.children),a=c.pop();return b},_build:function(a,b,c,d){var e,g=c-b+1,h=this._maxEntries;if(h>=g)return e={children:a.slice(b,c+1),height:1,bbox:null,leaf:!0},f(e,this.toBBox),e;d||(d=Math.ceil(Math.log(g)/Math.log(h)),h=Math.ceil(g/Math.pow(h,d-1))),e={children:[],height:d,bbox:null};var i,j,k,l,m=Math.ceil(g/h),n=m*Math.ceil(Math.sqrt(h));for(r(a,b,c,n,this.compareMinX),i=b;c>=i;i+=n)for(k=Math.min(i+n-1,c),r(a,i,k,m,this.compareMinY),j=i;k>=j;j+=m)l=Math.min(j+m-1,k),e.children.push(this._build(a,j,l,d-1));return f(e,this.toBBox),e},_chooseSubtree:function(a,b,c,d){for(var e,f,g,h,i,j,k,m;;){if(d.push(b),b.leaf||d.length-1===c)break;for(k=m=1/0,e=0,f=b.children.length;f>e;e++)g=b.children[e],i=l(g.bbox),j=n(a,g.bbox)-i,m>j?(m=j,k=k>i?i:k,h=g):j===m&&k>i&&(k=i,h=g);b=h}return b},_insert:function(a,b,c){var d=this.toBBox,e=c?a.bbox:d(a),f=[],g=this._chooseSubtree(e,this.data,b,f);for(g.children.push(a),i(g.bbox,e);b>=0&&f[b].children.length>this._maxEntries;)this._split(f,b),b--;this._adjustParentBBoxes(e,f,b)},_split:function(a,b){var c=a[b],d=c.children.length,e=this._minEntries;this._chooseSplitAxis(c,e,d);var g={children:c.children.splice(this._chooseSplitIndex(c,e,d)),height:c.height};c.leaf&&(g.leaf=!0),f(c,this.toBBox),f(g,this.toBBox),b?a[b-1].children.push(g):this._splitRoot(c,g)},_splitRoot:function(a,b){this.data={children:[a,b],height:a.height+1},f(this.data,this.toBBox)},_chooseSplitIndex:function(a,b,c){var d,e,f,h,i,j,k,m;for(j=k=1/0,d=b;c-b>=d;d++)e=g(a,0,d,this.toBBox),f=g(a,d,c,this.toBBox),h=o(e,f),i=l(e)+l(f),j>h?(j=h,m=d,k=k>i?i:k):h===j&&k>i&&(k=i,m=d);return m},_chooseSplitAxis:function(a,b,c){var d=a.leaf?this.compareMinX:j,e=a.leaf?this.compareMinY:k,f=this._allDistMargin(a,b,c,d),g=this._allDistMargin(a,b,c,e);g>f&&a.children.sort(d)},_allDistMargin:function(a,b,c,d){a.children.sort(d);var e,f,h=this.toBBox,j=g(a,0,b,h),k=g(a,c-b,c,h),l=m(j)+m(k);for(e=b;c-b>e;e++)f=a.children[e],i(j,a.leaf?h(f):f.bbox),l+=m(j);for(e=c-b-1;e>=b;e--)f=a.children[e],i(k,a.leaf?h(f):f.bbox),l+=m(k);return l},_adjustParentBBoxes:function(a,b,c){for(var d=c;d>=0;d--)i(b[d].bbox,a)},_condense:function(a){for(var b,c=a.length-1;c>=0;c--)0===a[c].children.length?c>0?(b=a[c-1].children,b.splice(b.indexOf(a[c]),1)):this.clear():f(a[c],this.toBBox)},_initFormat:function(a){var b=["return a"," - b",";"];this.compareMinX=new Function("a","b",b.join(a[0])),this.compareMinY=new Function("a","b",b.join(a[1])),this.toBBox=new Function("a","return [a"+a.join(", a")+"];")}},d=function(){return e}.call(b,c,b,a),!(void 0!==d&&(a.exports=d))}()}])});